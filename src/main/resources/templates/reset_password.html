<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u - Ti·ªám T·∫°p H√≥a KeyT</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">
    <link rel="stylesheet" th:href="@{/modern-styles.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="page-background">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="container-sm w-full">
                
                <!-- Brand Logo -->
                <div class="brand-logo animate-fade-in">
                    <i class="fas fa-sparkles" style="margin-right: 0.5rem; color: #38bdf8;"></i>
                    Ti·ªám T·∫°p H√≥a KeyT
                </div>

                <!-- Reset Password Card -->
                <div class="card animate-scale-in" style="animation-delay: 0.2s;">
                    
                    <!-- Header -->
                    <div class="text-center mb-8">
                        <div class="reset-icon-container mb-4">
                            <div class="reset-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                        </div>
                        <h1 class="heading-2 mb-2" style="color: var(--neutral-800);">ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</h1>
                        <p class="body" style="color: var(--neutral-600);">
                            Nh·∫≠p m·∫≠t kh·∫©u m·ªõi cho t√†i kho·∫£n c·ªßa b·∫°n
                        </p>
                    </div>

                    <!-- Alerts -->
                    <div th:if="${error}" class="alert alert-error animate-slide-in">
                        <i class="fas fa-exclamation-circle"></i>
                        <span th:text="${error}"></span>
                    </div>

                    <div th:if="${success}" class="alert alert-success animate-slide-in">
                        <i class="fas fa-check-circle"></i>
                        <span th:text="${success}"></span>
                    </div>

                    <!-- Reset Password Form -->
                    <form th:if="${validToken or (token and not error)}" th:action="@{/reset-password}" method="post" id="resetForm" class="animate-slide-in" style="animation-delay: 0.4s;">
                        <input type="hidden" name="token" th:value="${token}">
                        
                        <!-- New Password Input -->
                        <div class="input-group">
                            <label for="password" class="input-label">
                                <i class="fas fa-lock" style="margin-right: 0.5rem; color: var(--primary-500);"></i>
                                M·∫≠t kh·∫©u m·ªõi
                            </label>
                            <div style="position: relative;">
                                <input type="password" 
                                       id="password" 
                                       name="password" 
                                       class="input"
                                       placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)" 
                                       required 
                                       minlength="6"
                                       autocomplete="new-password">
                                <button type="button" class="input-icon" onclick="togglePassword('password')">
                                    <i class="fas fa-eye" id="passwordToggleIcon"></i>
                                </button>
                            </div>
                            <div class="password-strength" id="passwordStrength"></div>
                        </div>
                        
                        <!-- Confirm Password Input -->
                        <div class="input-group">
                            <label for="confirmPassword" class="input-label">
                                <i class="fas fa-lock" style="margin-right: 0.5rem; color: var(--secondary-500);"></i>
                                X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi
                            </label>
                            <div style="position: relative;">
                                <input type="password" 
                                       id="confirmPassword" 
                                       name="confirmPassword" 
                                       class="input"
                                       placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" 
                                       required
                                       autocomplete="new-password">
                                <button type="button" class="input-icon" onclick="togglePassword('confirmPassword')">
                                    <i class="fas fa-eye" id="confirmPasswordToggleIcon"></i>
                                </button>
                            </div>
                            <div class="password-strength" id="confirmStrength"></div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-full btn-lg mb-6" id="submitBtn">
                            <i class="fas fa-save"></i>
                            ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u
                        </button>

                    </form>
                    
                    <!-- Message when no valid token -->
                    <div th:if="${not validToken and not token}" class="alert alert-error animate-slide-in">
                        <i class="fas fa-exclamation-circle"></i>
                        Link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u kh√¥ng h·ª£p l·ªá. Vui l√≤ng y√™u c·∫ßu link m·ªõi.
                    </div>

                    <!-- Back to Login -->
                    <div class="text-center animate-slide-in" style="animation-delay: 0.6s;">
                        <a th:href="@{/login}" class="btn btn-outline btn-full">
                            <i class="fas fa-arrow-left"></i>
                            Quay l·∫°i trang ƒëƒÉng nh·∫≠p
                        </a>
                    </div>

                </div>

                <!-- Security Tips Card -->
                <div class="card card-compact animate-slide-in" style="animation-delay: 1s; margin-top: var(--space-6);">
                    <div class="text-center mb-4">
                        <i class="fas fa-shield-alt" style="color: var(--success-500); font-size: var(--text-2xl); margin-bottom: var(--space-2);"></i>
                        <h3 class="heading-5 mb-3" style="color: var(--neutral-800);">B·∫£o m·∫≠t t√†i kho·∫£n</h3>
                    </div>
                    
                    <div class="security-tips">
                        <div class="tip-item">
                            <i class="fas fa-check-circle" style="color: var(--success-500);"></i>
                            <span>S·ª≠ d·ª•ng m·∫≠t kh·∫©u m·∫°nh v·ªõi √≠t nh·∫•t 8 k√Ω t·ª±</span>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-check-circle" style="color: var(--success-500);"></i>
                            <span>K·∫øt h·ª£p ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát</span>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-check-circle" style="color: var(--success-500);"></i>
                            <span>Kh√¥ng s·ª≠ d·ª•ng th√¥ng tin c√° nh√¢n d·ªÖ ƒëo√°n</span>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="text-center mt-8 animate-fade-in" style="animation-delay: 1.2s;">
                    <p class="body-small" style="color: var(--neutral-500);">
                        ¬© 2024 Ti·ªám T·∫°p H√≥a KeyT. All rights reserved.
                    </p>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Password Toggle Functions
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const iconId = inputId === 'password' ? 'passwordToggleIcon' : 'confirmPasswordToggleIcon';
            const icon = document.getElementById(iconId);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        // Password Strength Checker
        function checkPasswordStrength(password) {
            let strength = 0;
            let feedback = '';
            
            if (password.length >= 6) strength++;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            if (strength < 3) {
                feedback = '<span style="color: var(--error-600);"><i class="fas fa-times-circle"></i> M·∫≠t kh·∫©u y·∫øu</span>';
            } else if (strength < 5) {
                feedback = '<span style="color: var(--warning-600);"><i class="fas fa-exclamation-circle"></i> M·∫≠t kh·∫©u trung b√¨nh</span>';
            } else {
                feedback = '<span style="color: var(--success-600);"><i class="fas fa-check-circle"></i> M·∫≠t kh·∫©u m·∫°nh</span>';
            }
            
            return feedback;
        }

        // Form Validation
        function validateForm() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const submitBtn = document.getElementById('submitBtn');
            
            // Check password strength
            const strengthDiv = document.getElementById('passwordStrength');
            if (password) {
                strengthDiv.innerHTML = checkPasswordStrength(password);
            } else {
                strengthDiv.innerHTML = '';
            }
            
            // Check password match
            const confirmDiv = document.getElementById('confirmStrength');
            if (confirmPassword) {
                if (password === confirmPassword && password.length >= 6) {
                    confirmDiv.innerHTML = '<span style="color: var(--success-600);"><i class="fas fa-check-circle"></i> M·∫≠t kh·∫©u kh·ªõp</span>';
                } else if (password === confirmPassword) {
                    confirmDiv.innerHTML = '<span style="color: var(--warning-600);"><i class="fas fa-exclamation-circle"></i> M·∫≠t kh·∫©u kh·ªõp nh∆∞ng qu√° ng·∫Øn</span>';
                } else {
                    confirmDiv.innerHTML = '<span style="color: var(--error-600);"><i class="fas fa-times-circle"></i> M·∫≠t kh·∫©u kh√¥ng kh·ªõp</span>';
                }
            } else {
                confirmDiv.innerHTML = '';
            }
            
            // Enable/disable submit button
            const isValid = password.length >= 6 && password === confirmPassword;
            submitBtn.disabled = !isValid;
            
            if (isValid) {
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            }
        }

        // Add event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const form = document.getElementById('resetForm');
            
            if (passwordInput && confirmPasswordInput) {
                passwordInput.addEventListener('input', validateForm);
                confirmPasswordInput.addEventListener('input', validateForm);
                
                // Initial validation
                validateForm();
            }

            // Form submission with loading state
            if (form) {
                form.addEventListener('submit', function(e) {
                    const submitBtn = document.getElementById('submitBtn');
                    const originalContent = submitBtn.innerHTML;
                    
                    submitBtn.innerHTML = `
                        <div class="loading-spinner"></div>
                        ƒêang ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u...
                    `;
                    submitBtn.disabled = true;
                    
                    // Re-enable if form validation fails
                    setTimeout(() => {
                        if (!form.checkValidity()) {
                            submitBtn.innerHTML = originalContent;
                            submitBtn.disabled = false;
                        }
                    }, 100);
                });
            }
        });
    </script>

    <!-- Custom styles for reset password page -->
    <style>
        .reset-icon-container {
            display: inline-block;
            position: relative;
        }

        .reset-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--gradient-accent);
            color: white;
            font-size: var(--text-2xl);
            animation: lock-animation 2s ease-in-out infinite;
        }

        @keyframes lock-animation {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-5deg) scale(1.05); }
            75% { transform: rotate(5deg) scale(1.05); }
        }

        .password-strength {
            font-size: var(--text-sm);
            margin-top: var(--space-2);
            min-height: 1.5rem;
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .security-tips {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .tip-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-sm);
            color: var(--neutral-700);
        }

        .loading-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: var(--space-2);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- Floating particles -->
    <div id="particles" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
    </div>

    <script>
        // Add floating particles for dreamy effect
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 8;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const colors = ['rgba(239, 68, 68, 0.4)', 'rgba(56, 189, 248, 0.4)', 'rgba(168, 85, 247, 0.4)'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 5 + 3}px;
                    height: ${Math.random() * 5 + 3}px;
                    background: radial-gradient(circle, ${color} 0%, transparent 70%);
                    border-radius: 50%;
                    animation: float ${Math.random() * 4 + 3}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 2}s;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                `;
                particlesContainer.appendChild(particle);
            }
        }

        // Float animation
        const floatStyle = document.createElement('style');
        floatStyle.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px); opacity: 0.6; }
                50% { transform: translateY(-15px); opacity: 0.3; }
            }
        `;
        document.head.appendChild(floatStyle);
        
        // Initialize particles
        setTimeout(createParticles, 1000);
    </script>
</body>
</html> 