<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Ti·ªám T·∫°p H√≥a KeyT</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
    <link rel="stylesheet" th:href="@{/modern-styles.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="page-background">
        
        <!-- Admin Navigation Header -->
        <nav class="admin-nav animate-slide-in">
            <div class="container flex items-center justify-between" style="padding: var(--space-4) var(--space-4);">
                <div class="flex items-center gap-4">
                    <div class="admin-badge">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div>
                        <h1 class="heading-5" style="color: var(--neutral-800); margin: 0;">Admin Dashboard</h1>
                        <p class="caption" style="color: var(--neutral-600); margin: 0;">Ti·ªám T·∫°p H√≥a KeyT</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <div class="admin-menu">
                        <button class="menu-toggle" onclick="toggleMobileMenu()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="menu-items" id="adminMenu">
                            <a th:href="@{/admin/add-chatgpt-email}" class="menu-item">
                                <i class="fas fa-plus-circle"></i>
                                Th√™m ChatGPT
                            </a>
                            <a th:href="@{/admin/chatgpt-accounts}" class="menu-item">
                                <i class="fas fa-list"></i>
                                Qu·∫£n l√Ω Accounts
                            </a>
                            <a th:href="@{/get-otp}" class="menu-item">
                                <i class="fas fa-key"></i>
                                L·∫•y OTP
                            </a>
                            <a th:href="@{/logout}" class="menu-item logout">
                                <i class="fas fa-sign-out-alt"></i>
                                ƒêƒÉng xu·∫•t
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container" style="padding: var(--space-8) var(--space-4);">
            
            <!-- Welcome Section -->
            <div class="welcome-section animate-fade-in">
                <div class="welcome-content">
                    <h2 class="heading-2 mb-3" style="color: var(--neutral-800);">Ch√†o m·ª´ng Admin! üëã</h2>
                    <p class="body-large" style="color: var(--neutral-600);">
                        Qu·∫£n l√Ω h·ªá th·ªëng v√† theo d√µi ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng m·ªôt c√°ch hi·ªáu qu·∫£.
                    </p>
                </div>
                <div class="welcome-actions">
                    <a th:href="@{/admin/add-chatgpt-email}" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus-circle"></i>
                        Th√™m ChatGPT Email
                    </a>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid animate-slide-in" style="animation-delay: 0.2s;">
                
                <!-- Total Users -->
                <div class="stat-card users">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalUsers">-</div>
                        <div class="stat-label">T·ªïng Users</div>
                    </div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+12%</span>
                    </div>
                </div>

                <!-- ChatGPT Accounts -->
                <div class="stat-card accounts">
                    <div class="stat-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalAccounts">-</div>
                        <div class="stat-label">ChatGPT Accounts</div>
                    </div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+3</span>
                    </div>
                </div>

                <!-- OTP Requests Today -->
                <div class="stat-card requests">
                    <div class="stat-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="todayRequests">-</div>
                        <div class="stat-label">OTP h√¥m nay</div>
                    </div>
                    <div class="stat-trend neutral">
                        <i class="fas fa-minus"></i>
                        <span>0%</span>
                    </div>
                </div>

                <!-- Active Sessions -->
                <div class="stat-card sessions">
                    <div class="stat-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="activeSessions">-</div>
                        <div class="stat-label">Phi√™n ho·∫°t ƒë·ªông</div>
                    </div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+2</span>
                    </div>
                </div>

            </div>

            <!-- Quick Actions -->
            <div class="animate-slide-in" style="animation-delay: 0.4s;">
                <h3 class="heading-3 mb-6 text-center" style="color: var(--neutral-800);">Thao t√°c nhanh</h3>
                
                <div class="action-grid">
                    
                    <!-- Add ChatGPT Email -->
                    <div class="action-card" onclick="window.location.href='/admin/add-chatgpt-email'">
                        <div class="action-icon add">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <h4 class="heading-5 mb-2">Th√™m ChatGPT Email</h4>
                        <p class="body" style="color: var(--neutral-600);">
                            Th√™m email ChatGPT m·ªõi v·ªõi secret key ƒë·ªÉ t·∫°o OTP
                        </p>
                        <div class="action-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>

                    <!-- Manage Accounts -->
                    <div class="action-card" onclick="window.location.href='/admin/chatgpt-accounts'">
                        <div class="action-icon manage">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h4 class="heading-5 mb-2">Qu·∫£n l√Ω Accounts</h4>
                        <p class="body" style="color: var(--neutral-600);">
                            Xem, s·ª≠a, x√≥a c√°c t√†i kho·∫£n ChatGPT hi·ªán c√≥
                        </p>
                        <div class="action-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>

                    <!-- View User History -->
                    <div class="action-card" onclick="showUserHistoryModal()">
                        <div class="action-icon history">
                            <i class="fas fa-history"></i>
                        </div>
                        <h4 class="heading-5 mb-2">L·ªãch s·ª≠ User</h4>
                        <p class="body" style="color: var(--neutral-600);">
                            Xem l·ªãch s·ª≠ ƒëƒÉng nh·∫≠p v√† ho·∫°t ƒë·ªông c·ªßa users
                        </p>
                        <div class="action-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>

                    <!-- System Debug -->
                    <div class="action-card" onclick="showDebugModal()">
                        <div class="action-icon debug">
                            <i class="fas fa-bug"></i>
                        </div>
                        <h4 class="heading-5 mb-2">System Debug</h4>
                        <p class="body" style="color: var(--neutral-600);">
                            Ki·ªÉm tra k·∫øt n·ªëi database v√† t·∫°o test account
                        </p>
                        <div class="action-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>

                    <!-- Get OTP -->
                    <div class="action-card" onclick="window.location.href='/get-otp'">
                        <div class="action-icon otp">
                            <i class="fas fa-key"></i>
                        </div>
                        <h4 class="heading-5 mb-2">L·∫•y OTP</h4>
                        <p class="body" style="color: var(--neutral-600);">
                            Test l·∫•y m√£ OTP t·ª´ email ChatGPT
                        </p>
                        <div class="action-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>

                    <!-- Email Test -->
                    <div class="action-card" onclick="testEmailConfiguration()">
                        <div class="action-icon email">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h4 class="heading-5 mb-2">Test Email</h4>
                        <p class="body" style="color: var(--neutral-600);">
                            Ki·ªÉm tra c·∫•u h√¨nh g·ª≠i email c·ªßa h·ªá th·ªëng
                        </p>
                        <div class="action-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <!-- Footer -->
        <footer class="admin-footer">
            <div class="container text-center">
                <p class="body-small" style="color: var(--neutral-500);">
                    ¬© 2024 Ti·ªám T·∫°p H√≥a KeyT - Admin Panel. All rights reserved.
                </p>
            </div>
        </footer>

    </div>

    <!-- Debug Modal -->
    <div class="modal-overlay" id="debugModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="heading-4">System Debug</h3>
                <button class="modal-close" onclick="closeModal('debugModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="debug-actions">
                    <button class="btn btn-outline btn-full mb-3" onclick="testDatabase()">
                        <i class="fas fa-database"></i>
                        Test Database Connection
                    </button>
                    <button class="btn btn-outline btn-full mb-3" onclick="viewChatGptAccounts()">
                        <i class="fas fa-list"></i>
                        View All ChatGPT Accounts
                    </button>
                    <button class="btn btn-outline btn-full" onclick="createTestAccount()">
                        <i class="fas fa-plus"></i>
                        Create Test Account
                    </button>
                </div>
                <div class="debug-result" id="debugResult"></div>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('adminMenu');
            menu.classList.toggle('active');
        }

        // Modal functions
        function showDebugModal() {
            document.getElementById('debugModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Debug functions
        async function testDatabase() {
            const result = document.getElementById('debugResult');
            result.innerHTML = '<div class="loading">Testing database connection...</div>';
            
            try {
                const response = await fetch('/admin/debug/test-db');
                const data = await response.text();
                result.innerHTML = `<div class="alert alert-success">${data}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }

        async function viewChatGptAccounts() {
            const result = document.getElementById('debugResult');
            result.innerHTML = '<div class="loading">Loading ChatGPT accounts...</div>';
            
            try {
                const response = await fetch('/admin/debug/chatgpt-accounts');
                const data = await response.text();
                result.innerHTML = `<div class="alert alert-info"><pre>${data}</pre></div>`;
            } catch (error) {
                result.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }

        async function createTestAccount() {
            const result = document.getElementById('debugResult');
            result.innerHTML = '<div class="loading">Creating test account...</div>';
            
            try {
                const response = await fetch('/admin/debug/create-test-account');
                const data = await response.text();
                result.innerHTML = `<div class="alert alert-success">${data}</div>`;
            } catch (error) {
                result.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }

        async function testEmailConfiguration() {
            const result = document.createElement('div');
            result.className = 'alert alert-info';
            result.innerHTML = '<div class="loading">Testing email configuration...</div>';
            document.body.appendChild(result);
            
            setTimeout(() => {
                try {
                    // Simulate API call - replace with actual endpoint
                    result.innerHTML = '<i class="fas fa-check-circle"></i> Email configuration test completed! Check server logs for details.';
                    result.className = 'alert alert-success';
                    
                    setTimeout(() => {
                        document.body.removeChild(result);
                    }, 5000);
                } catch (error) {
                    result.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error: ${error.message}`;
                    result.className = 'alert alert-error';
                }
            }, 2000);
        }

        function showUserHistoryModal() {
            alert('User History feature will be implemented soon!');
        }

        // Load stats (mock data - replace with actual API calls)
        function loadStats() {
            // Simulate loading stats
            setTimeout(() => {
                document.getElementById('totalUsers').textContent = '24';
                document.getElementById('totalAccounts').textContent = '8';
                document.getElementById('todayRequests').textContent = '156';
                document.getElementById('activeSessions').textContent = '12';
            }, 1000);

            // Animate numbers
            setTimeout(() => {
                animateNumbers();
            }, 1200);
        }

        function animateNumbers() {
            const numbers = document.querySelectorAll('.stat-number');
            numbers.forEach(num => {
                const target = parseInt(num.textContent);
                let current = 0;
                const increment = target / 30;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    num.textContent = Math.floor(current);
                }, 50);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }
                });
            });
        });
    </script>

    <!-- Admin-specific styles -->
    <style>
        .admin-nav {
            backdrop-filter: blur(20px);
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.1), rgba(255, 140, 0, 0.1));
            border-bottom: 2px solid rgba(255, 140, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: var(--shadow-lg);
        }

        .admin-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF8C00, #FF6347);
            color: white;
            font-size: var(--text-lg);
        }

        .admin-menu {
            position: relative;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--neutral-700);
            font-size: var(--text-lg);
            cursor: pointer;
            padding: var(--space-2);
        }

        .menu-items {
            display: flex;
            gap: var(--space-2);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--rounded-lg);
            text-decoration: none;
            color: var(--neutral-700);
            transition: all var(--transition-fast);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        .menu-item:hover {
            background: rgba(255, 140, 0, 0.1);
            color: var(--neutral-800);
            transform: translateY(-1px);
        }

        .menu-item.logout {
            color: var(--error-600);
        }

        .menu-item.logout:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-700);
        }

        .welcome-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--rounded-3xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-12);
        }

        .stat-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--rounded-2xl);
            padding: var(--space-6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .stat-card.users::before { background: var(--primary-500); }
        .stat-card.accounts::before { background: var(--secondary-500); }
        .stat-card.requests::before { background: var(--accent-500); }
        .stat-card.sessions::before { background: var(--success-500); }

        .stat-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: var(--space-4);
            font-size: var(--text-xl);
            color: white;
        }

        .stat-card.users .stat-icon { background: var(--primary-500); }
        .stat-card.accounts .stat-icon { background: var(--secondary-500); }
        .stat-card.requests .stat-icon { background: var(--accent-500); }
        .stat-card.sessions .stat-icon { background: var(--success-500); }

        .stat-number {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            color: var(--neutral-800);
            margin-bottom: var(--space-1);
        }

        .stat-label {
            font-size: var(--text-sm);
            color: var(--neutral-600);
            font-weight: var(--font-medium);
        }

        .stat-trend {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
        }

        .stat-trend.positive { color: var(--success-600); }
        .stat-trend.negative { color: var(--error-600); }
        .stat-trend.neutral { color: var(--neutral-500); }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
        }

        .action-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--rounded-2xl);
            padding: var(--space-6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .action-card:hover .action-arrow {
            transform: translateX(4px);
        }

        .action-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: var(--space-4);
            font-size: var(--text-xl);
            color: white;
        }

        .action-icon.add { background: var(--success-500); }
        .action-icon.manage { background: var(--primary-500); }
        .action-icon.history { background: var(--secondary-500); }
        .action-icon.debug { background: var(--warning-500); }
        .action-icon.otp { background: var(--accent-500); }
        .action-icon.email { background: var(--primary-600); }

        .action-arrow {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            color: var(--neutral-400);
            transition: all var(--transition-fast);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .modal {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--rounded-3xl);
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-2xl);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--neutral-600);
            font-size: var(--text-lg);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: 50%;
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--neutral-800);
        }

        .modal-body {
            padding: var(--space-6);
        }

        .debug-result {
            margin-top: var(--space-4);
            max-height: 300px;
            overflow-y: auto;
        }

        .admin-footer {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            padding: var(--space-6) 0;
            margin-top: var(--space-16);
        }

        .loading {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--neutral-600);
        }

        .loading::before {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid var(--neutral-300);
            border-top: 2px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .welcome-section {
                flex-direction: column;
                text-align: center;
                gap: var(--space-4);
            }

            .menu-toggle {
                display: block;
            }

            .menu-items {
                position: absolute;
                top: 100%;
                right: 0;
                background: var(--gradient-glass);
                backdrop-filter: blur(20px);
                border-radius: var(--rounded-xl);
                border: 1px solid rgba(255, 255, 255, 0.2);
                padding: var(--space-4);
                display: none;
                flex-direction: column;
                min-width: 200px;
                box-shadow: var(--shadow-xl);
            }

            .menu-items.active {
                display: flex;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .action-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html> 