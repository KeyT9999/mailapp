<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="fragments/layout :: head('L·∫•y OTP')"></head>
<body class="app-layout">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="page-background">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="container-sm w-full">
                
                <!-- Main Card -->
                <div class="card animate-scale-in" style="animation-delay: 0.2s;">
                    
                    <!-- Header -->
                    <div class="text-center mb-8">
                        <div class="otp-icon-container mb-4">
                            <div class="otp-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="otp-pulse"></div>
                        </div>
                        <h1 class="heading-2 mb-2" style="color: var(--neutral-800);">L·∫•y m√£ OTP</h1>
                        <p class="body" style="color: var(--neutral-600);">Nh·∫≠p email ChatGPT ƒë·ªÉ nh·∫≠n m√£ x√°c th·ª±c</p>
                    </div>

                    <!-- Alerts -->
                    <div th:if="${error}" class="alert alert-error animate-slide-in" id="errorAlert">
                        <i class="fas fa-exclamation-circle"></i>
                        <span th:text="${error}"></span>
                    </div>

                    <!-- OTP Form -->
                    <form th:action="@{/get-otp}" method="post" class="animate-slide-in" style="animation-delay: 0.4s;" id="otpForm">
                        
                        <!-- ChatGPT Email Input -->
                        <div class="input-group">
                            <label for="chatgptEmail" class="input-label">
                                <i class="fas fa-robot" style="margin-right: 0.5rem; color: var(--secondary-500);"></i>
                                Email ChatGPT
                            </label>
                            <input type="email" 
                                   id="chatgptEmail" 
                                   name="chatgptEmail" 
                                   class="input"
                                   placeholder="Nh·∫≠p email ChatGPT ƒë∆∞·ª£c c·∫•p"
                                   required 
                                   autocomplete="email">
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-full btn-lg" id="submitBtn">
                            <i class="fas fa-paper-plane"></i>
                            L·∫•y m√£ OTP
                        </button>

                    </form>

                    <!-- OTP Display (Show when OTP is retrieved) -->
                    <div th:if="${otp}" class="otp-display animate-scale-in" style="animation-delay: 0.6s;" id="otpDisplay">
                        <div class="otp-success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 class="heading-4 mb-4 text-center" style="color: var(--success-700);">
                            L·∫•y OTP th√†nh c√¥ng! üéâ
                        </h3>
                        <div class="otp-code" id="otpCode">
                            <span th:text="${otp}">123456</span>
                        </div>
                        <p class="body text-center mb-4" style="color: var(--neutral-600);">
                            M√£ OTP c√≥ hi·ªáu l·ª±c trong <span class="countdown" id="countdown">30</span> gi√¢y
                        </p>
                        <div class="otp-actions">
                            <button class="btn btn-outline btn-full" onclick="copyOTP()" id="copyBtn">
                                <i class="fas fa-copy"></i>
                                Sao ch√©p OTP
                            </button>
                            <button class="btn btn-ghost btn-full mt-3" onclick="refreshOTP()">
                                <i class="fas fa-sync-alt"></i>
                                L·∫•y m√£ m·ªõi
                            </button>
                        </div>
                    </div>

                </div>

                <!-- Info Card -->
                <div class="card card-compact animate-slide-in" style="animation-delay: 0.8s; margin-top: var(--space-6);">
                    <div class="text-center mb-4">
                        <i class="fas fa-info-circle" style="color: var(--primary-500); font-size: var(--text-2xl); margin-bottom: var(--space-2);"></i>
                        <h3 class="heading-5 mb-3" style="color: var(--neutral-800);">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
                    </div>
                    
                    <div class="info-steps">
                        <div class="info-step">
                            <div class="step-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="step-text">
                                <strong>B∆∞·ªõc 1:</strong> Nh·∫≠p email ChatGPT ƒë∆∞·ª£c admin c·∫•p
                            </div>
                        </div>
                        
                        <div class="info-step">
                            <div class="step-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="step-text">
                                <strong>B∆∞·ªõc 2:</strong> Nh·∫•n "L·∫•y m√£ OTP" ƒë·ªÉ t·∫°o m√£ x√°c th·ª±c
                            </div>
                        </div>
                        
                        <div class="info-step">
                            <div class="step-icon">
                                <i class="fas fa-clipboard"></i>
                            </div>
                            <div class="step-text">
                                <strong>B∆∞·ªõc 3:</strong> Sao ch√©p m√£ OTP v√† s·ª≠ d·ª•ng khi c·∫ßn thi·∫øt
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4" style="background: rgba(255, 193, 7, 0.1); border-radius: var(--rounded-lg); border-left: 4px solid var(--warning-500);">
                        <p class="body-small" style="color: var(--warning-700);">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>L∆∞u √Ω:</strong> M·ªói m√£ OTP ch·ªâ c√≥ hi·ªáu l·ª±c trong 30 gi√¢y. S·ª≠ d·ª•ng ngay sau khi l·∫•y ƒë∆∞·ª£c m√£.
                        </p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="text-center mt-8 animate-fade-in" style="animation-delay: 1s;">
                    <p class="body-small" style="color: var(--neutral-500);">
                        C·∫ßn h·ªó tr·ª£? Li√™n h·ªá 
                        <a href="https://zalo.me/0868899104" target="_blank" style="color: var(--primary-600); text-decoration: none;">
                            Zalo: 0868899104
                        </a>
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- Common Scripts -->
    <div th:replace="fragments/layout :: commonScripts"></div>

    <script>
        let countdownTimer;
        let otpValue = '';

        // Auto-focus on input
        document.addEventListener('DOMContentLoaded', function() {
            const emailInput = document.getElementById('chatgptEmail');
            if (emailInput) {
                emailInput.focus();
            }

            // Start countdown if OTP is displayed
            const otpDisplay = document.getElementById('otpDisplay');
            if (otpDisplay) {
                const otpCodeElement = document.querySelector('#otpCode span');
                if (otpCodeElement) {
                    otpValue = otpCodeElement.textContent;
                    startCountdown(30);
                }
            }
        });

        // Form submission with loading state
        document.getElementById('otpForm').addEventListener('submit', function(e) {
            const submitBtn = document.getElementById('submitBtn');
            const originalContent = submitBtn.innerHTML;
            
            submitBtn.innerHTML = `
                <div class="loading-spinner"></div>
                ƒêang l·∫•y OTP...
            `;
            submitBtn.disabled = true;
            
            // Re-enable if form validation fails
            setTimeout(() => {
                if (!this.checkValidity()) {
                    submitBtn.innerHTML = originalContent;
                    submitBtn.disabled = false;
                }
            }, 100);
        });

        // Copy OTP function
        function copyOTP() {
            const otpCode = document.querySelector('#otpCode span');
            if (otpCode) {
                navigator.clipboard.writeText(otpCode.textContent).then(() => {
                    const copyBtn = document.getElementById('copyBtn');
                    const originalContent = copyBtn.innerHTML;
                    
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> ƒê√£ sao ch√©p!';
                    copyBtn.classList.add('btn-success');
                    copyBtn.classList.remove('btn-outline');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalContent;
                        copyBtn.classList.remove('btn-success');
                        copyBtn.classList.add('btn-outline');
                    }, 2000);
                }).catch(err => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = otpCode.textContent;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    showToast('OTP ƒë√£ ƒë∆∞·ª£c sao ch√©p!', 'success');
                });
            }
        }

        // Refresh OTP function
        function refreshOTP() {
            const form = document.getElementById('otpForm');
            const emailInput = document.getElementById('chatgptEmail');
            
            if (emailInput.value) {
                form.submit();
            } else {
                showToast('Vui l√≤ng nh·∫≠p email ChatGPT!', 'error');
            }
        }

        // Countdown timer
        function startCountdown(seconds) {
            let timeLeft = seconds;
            const countdownElement = document.getElementById('countdown');
            
            countdownTimer = setInterval(() => {
                timeLeft--;
                if (countdownElement) {
                    countdownElement.textContent = timeLeft;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(countdownTimer);
                    showExpiredState();
                }
            }, 1000);
        }

        // Show expired state
        function showExpiredState() {
            const otpDisplay = document.getElementById('otpDisplay');
            if (otpDisplay) {
                otpDisplay.classList.add('expired');
                const countdownElement = document.getElementById('countdown');
                if (countdownElement) {
                    countdownElement.textContent = '0';
                }
                showToast('M√£ OTP ƒë√£ h·∫øt h·∫°n. Vui l√≤ng l·∫•y m√£ m·ªõi!', 'warning');
            }
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas fa-${getToastIcon(type)}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        function getToastIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }
    </script>

    <!-- Custom styles for OTP page -->
    <style>
        .otp-icon-container {
            position: relative;
            display: inline-block;
        }

        .otp-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            font-size: var(--text-3xl);
            position: relative;
            z-index: 2;
        }

        .otp-pulse {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid var(--primary-400);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.2); opacity: 0; }
        }

        .otp-display {
            background: linear-gradient(135deg, var(--success-50), var(--success-100));
            border-radius: var(--rounded-2xl);
            padding: var(--space-8);
            text-align: center;
            border: 2px solid var(--success-200);
            position: relative;
            overflow: hidden;
        }

        .otp-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .otp-success-icon {
            font-size: var(--text-4xl);
            color: var(--success-500);
            margin-bottom: var(--space-4);
        }

        .otp-code {
            background: white;
            border-radius: var(--rounded-xl);
            padding: var(--space-6);
            margin: var(--space-6) 0;
            border: 2px solid var(--success-300);
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        .otp-code span {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            color: var(--success-700);
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5em;
            text-align: center;
            display: block;
        }

        .otp-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .otp-display.expired {
            opacity: 0.6;
            filter: grayscale(0.5);
        }

        .otp-display.expired .otp-code {
            border-color: var(--error-300);
            background: var(--error-50);
        }

        .otp-display.expired .otp-code span {
            color: var(--error-600);
        }

        .info-steps {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .info-step {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .step-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary-100);
            color: var(--primary-600);
            flex-shrink: 0;
        }

        .step-text {
            color: var(--neutral-700);
            font-size: var(--text-sm);
        }

        .loading-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: var(--space-2);
        }

        .toast {
            position: fixed;
            top: var(--space-8);
            right: var(--space-8);
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--rounded-xl);
            padding: var(--space-4) var(--space-6);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            z-index: 1000;
            transform: translateX(100%);
            transition: all var(--transition-normal);
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border: 1px solid var(--success-300);
            color: var(--success-700);
        }

        .toast-error {
            border: 1px solid var(--error-300);
            color: var(--error-700);
        }

        .toast-warning {
            border: 1px solid var(--warning-300);
            color: var(--warning-700);
        }

        .toast-info {
            border: 1px solid var(--primary-300);
            color: var(--primary-700);
        }

        .countdown {
            font-weight: var(--font-bold);
            color: var(--warning-600);
        }

        @media (max-width: 640px) {
            .otp-code span {
                font-size: var(--text-2xl);
                letter-spacing: 0.3em;
            }

            .toast {
                top: var(--space-4);
                right: var(--space-4);
                left: var(--space-4);
                max-width: none;
            }
        }
    </style>

    <!-- Floating particles -->
    <div id="particles" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
    </div>
    
    <script>
        // Add floating particles for dreamy effect
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 10;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const colors = ['rgba(56, 189, 248, 0.5)', 'rgba(34, 197, 94, 0.5)', 'rgba(168, 85, 247, 0.5)'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 6 + 2}px;
                    height: ${Math.random() * 6 + 2}px;
                    background: radial-gradient(circle, ${color} 0%, transparent 70%);
                    border-radius: 50%;
                    animation: float ${Math.random() * 5 + 3}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 2}s;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                `;
                particlesContainer.appendChild(particle);
            }
        }

        // Float animation
        const floatStyle = document.createElement('style');
        floatStyle.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
                50% { transform: translateY(-20px) rotate(180deg); opacity: 0.3; }
            }
        `;
        document.head.appendChild(floatStyle);
        
        // Initialize particles
        setTimeout(createParticles, 1000);
    </script>
</body>
</html> 